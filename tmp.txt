#include <iostream>
#include <string>
#include <vector>
#include <cctype>

using namespace std;

class Sequence {
protected:
    string seq;
    static int count;

public:
    Sequence(const string& s) : seq(s) {
        count++;
        cout << "Sequence constructor called\n";
    }

    virtual ~Sequence() {
        count--;
        cout << "Sequence destructor called\n";
    }

    int length() const {
        return seq.length();
    }

    virtual void describe() const = 0;
    virtual bool isValid() const = 0;

    static int getCount() {
        return count;
    }
};

int Sequence::count = 0;


class DNASequence : public Sequence {
public:
    DNASequence(const string& s) : Sequence(s) {
        cout << "DNASequence constructor called\n";
    }

    ~DNASequence() override {
        cout << "DNASequence destructor called\n";
    }

    void describe() const override {
        cout << "DNA sequence: " << seq << "\n";
    }

    bool isValid() const override {
        for (char c : seq) {
            char u = toupper(c);
            if (u != 'A' && u != 'C' && u != 'G' && u != 'T')
                return false;
        }
        return true;
    }
};



class RNASequence : public Sequence {
public:
    RNASequence(const string& s) : Sequence(s) {
        cout << "RNASequence constructor called\n";
    }

    ~RNASequence() override {
        cout << "RNASequence destructor called\n";
    }

    void describe() const override {
        cout << "RNA sequence: " << seq << "\n";
    }

    bool isValid() const override {
        for (char c : seq) {
            char u = toupper(c);
            if (u != 'A' && u != 'C' && u != 'G' && u != 'U')
                return false;
        }
        return true;
    }
};



class ProteinSequence : public Sequence {
public:
    ProteinSequence(const string& s) : Sequence(s) {
        cout << "ProteinSequence constructor called\n";
    }

    ~ProteinSequence() override {
        cout << "ProteinSequence destructor called\n";
    }

    void describe() const override {
        cout << "Protein sequence: " << seq << "\n";
    }

    bool isValid() const override {
        const string validAA = "ACDEFGHIKLMNPQRSTVWY";
        for (char c : seq) {
            char u = toupper(c);
            if (validAA.find(u) == string::npos)
                return false;
        }
        return true;
    }
};


class Isoform {
private:
    string id;
    string name;
    Sequence* rna;   // polymorphism

public:
    Isoform(const string& i, const string& n, Sequence* r)
        : id(i), name(n), rna(r) {
        cout << "Isoform constructor called\n";
    }

    ~Isoform() {
        delete rna;
        cout << "Isoform destructor called\n";
    }

    void describe() const {
        cout << "Isoform: " << id << " " << name << "\n";
        rna->describe();
    }
};



class Gene {
private:
    string id, name, chrom, start, end, strand;
    vector<Isoform*> isoforms;

public:
    ~Gene() {
        for (auto i : isoforms)
            delete i;
    }

    void setId(const string& x) { id = x; }
    void setName(const string& x) { name = x; }
    void setChrom(const string& x) { chrom = x; }
    void setStart(const string& x) { start = x; }
    void setEnd(const string& x) { end = x; }
    void setStrand(const string& x) { strand = x; }

    void addIsoform(Isoform* iso) {
        isoforms.push_back(iso);
    }

    void describe() const {
        cout << "Gene: " << name << " (" << id << ") "
             << chrom << ":" << start << "-" << end
             << " strand " << strand << "\n";

        cout << "Isoforms:\n";
        for (auto i : isoforms)
            i->describe();
    }
};



int main() {

    vector<Sequence*> sequences;

    sequences.push_back(new DNASequence("ACTGGAGAAA"));
    sequences.push_back(new RNASequence("ACCUAGAU"));
    sequences.push_back(new ProteinSequence("ACDEFGHIK"));

    for (Sequence* s : sequences) {
        s->describe();
        cout << "Length: " << s->length() << "\n";
        cout << "Valid: " << s->isValid() << "\n\n";
    }

    cout << "Sequences alive: " << Sequence::getCount() << "\n";

    for (Sequence* s : sequences)
        delete s;

    sequences.clear();

    cout << "\n=== Gene with Isoforms ===\n";

    Gene g;
    g.setId("ENSG999");
    g.setName("MYGENE");
    g.setChrom("chr2");
    g.setStart("1000");
    g.setEnd("2000");
    g.setStrand("+");

    g.addIsoform(new Isoform(
        "ISO1", "main-iso", new RNASequence("ACCUAGAU")));

    g.addIsoform(new Isoform(
        "ISO2", "alt-iso", new RNASequence("AUGGCUU")));

    g.describe();

    cout << "Sequences alive: " << Sequence::getCount() << "\n";

    return 0;
}
